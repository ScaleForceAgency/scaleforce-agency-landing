---
import Layout from '~/layouts/PageLayout.astro';

import Hero from '~/components/widgets/Hero.astro';
import AiServicesPanel from '~/components/widgets/Content.astro';
import StandardServices from '~/components/widgets/Features2.astro';
import DevProcess from '~/components/widgets/Steps.astro';
import ClientSuccess from '~/components/widgets/Features.astro';
import ClientStats from '~/components/widgets/Stats.astro';
import FAQs from '~/components/widgets/FAQs.astro';
// import CallToAction from '~/components/widgets/CallToAction.astro';
import Contact from '~/components/widgets/Steps2.astro';
import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';

import { getPermalink } from '../utils/permalinks';
import { fetchRecords } from '../integrations/astro-airtable/astro-airtable';

// Fetch records from Airtable
// const images = await fetchRecords('tbloYsMufgsZtzC1K');
const pageContent = await fetchRecords('tblZ51CnMzxuJf5mN');

const metadata = {
  title: `${pageContent[0].title}`,
  ignoreTitleTemplate: true,
};

// // Fetch images from Contentful
import { contentfulClient } from "../lib/contentful";
// import { documentToHtmlString } from "@contentful/rich-text-html-renderer";
import type { EntryFieldTypes } from "contentful";

interface LandingImageFile {
  fields: {
    file: {
      url: EntryFieldTypes.Text
    }
  }
}

interface LandingImage {
  contentTypeId: "image";
  fields: {
    title: EntryFieldTypes.Text;
    alt: EntryFieldTypes.Text;
    file: LandingImageFile;
  }
}
const entries = await contentfulClient.getEntries<LandingImage>({
  content_type: "image",
});
const AiSummarizerAgent = entries.items[0];
const AiVoiceAgent = entries.items[1];
const AiAgentSwarm = entries.items[2];
const DevelopmentProcess = entries.items[3];

---

<Layout metadata={metadata}>
  
  <!-- Hero Widget ******************* -->
   
  <Hero
  id="welcome"
    title=`${pageContent[1].title}`
    subtitle=`${pageContent[1].description}`
    actions={[
      { variant: 'primary', text: `${pageContent[2].title}`, href: getPermalink(`${pageContent[2].description}`), icon: 'tabler:square-rounded-arrow-right' },
      { text: `${pageContent[3].title}`, href: getPermalink(`${pageContent[3].description}`) },
    ]}
  />

  <!-- AiServicesPanel Widget 1/3 **************** -->

  <AiServicesPanel
    id='services'
    isReversed
    tagline={`${pageContent[4].description}`}
    title={`${pageContent[4].title}`}
    items={[...pageContent].slice(6,10)}
    image={{
      src: 'https://images.ctfassets.net/7g58dl79e6zy/2SpFfcGBPLiJ5BNsKrEXkk/a2011ec94b22fe293f1cd8defac122d2/ai-summarizer-agent.png',
      alt: AiSummarizerAgent.fields.alt,
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">
        {`${pageContent[5].title}`}
      </h3>
      {`${pageContent[5].description}`}
    </Fragment>

    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </AiServicesPanel>

  <!-- AiServicesPanel Widget 2/3 **************** -->

  <AiServicesPanel
    isAfterContent
    items={[...pageContent].slice(11,15)}
    image={{
      src: 'https://images.ctfassets.net/7g58dl79e6zy/Wrbd82xoTsBC73B5fehXm/e7a29c128632de2e9b9a35e6aadbde01/ai-voice-agent.png',
      alt: AiVoiceAgent.fields.alt,
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">
        {`${pageContent[10].title}`}
      </h3>
      {`${pageContent[10].description}`}
    </Fragment>

    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </AiServicesPanel>

  <!-- AiServicesPanel Widget 3/3 **************** -->

  <AiServicesPanel
    isReversed
    isAfterContent
    items={[...pageContent].slice(16,20)}
    image={{
      src: 'https://images.ctfassets.net/7g58dl79e6zy/7f0vEO9M2v8HjkoHxBUoxU/088afbce684c618237b732e28fad94c4/ai-agent-swarm.png',
      alt: AiAgentSwarm.fields.alt,
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">
        {`${pageContent[15].title}`}
      </h3>
      {`${pageContent[15].description}`}
    </Fragment>

    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </AiServicesPanel>

  <!-- Standard Offerings Widget *************** -->

  <StandardServices
    title={`${pageContent[20].title}`}
    subtitle={`${pageContent[20].description}`}
    items={[...pageContent].slice(21,30)}
  >
  <Fragment slot="bg">
    <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
  </Fragment>
</StandardServices>

  <!-- Development Process Widget *************** -->

  <DevProcess
  id="features"
  tagline={`${pageContent[30].title}`}
  title={`${pageContent[31].title}`}
  subtitle={`${pageContent[31].description}`}
  items={[...pageContent].slice(32,37)}
  image={{
    src: 'https://images.ctfassets.net/7g58dl79e6zy/5nSGprH9KWchvi2TbiYRMV/414528b5e52b1df799d2538158afc0e5/development-process.png',
    alt: DevelopmentProcess.fields.alt,
  }}
/>

  <!-- Client Success Widget *************** -->

  <ClientSuccess
  title={`${pageContent[37].title}`}
  subtitle={`${pageContent[37].description}`}
    columns={2}
    items={[...pageContent].slice(38,44)}
  />
  
  <!-- Client Stats Widget *************** -->

  <ClientStats stats={[...pageContent].slice(45,49)} />

  <!-- FAQs Widget ******************* -->

  <FAQs
    id="faq"
    title={`${pageContent[49].title}`}
    items={[...pageContent].slice(50,54)}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </FAQs>

  <!-- Call To Action Widget *********** -->

  <!-- <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'Get template',
        href: 'https://github.com/onwidget/astrowind',
        target: '_blank',
        icon: 'tabler:download',
      },
    ]}
  >
    <Fragment slot="title">
      Astro&nbsp;+&nbsp;<br class="block sm:hidden" /><span class="sm:whitespace-nowrap">Tailwind CSS</span>
    </Fragment>

    <Fragment slot="subtitle">
      Be very surprised by these huge fake numbers you are seeing on this page. <br class="hidden md:inline" />Don't
      waste more time! :P
    </Fragment>
  </CallToAction> -->

  <!-- Contact Widget ****************** -->

  <Contact
    id="contact"
    title={`${pageContent[54].title}`}
    subtitle={`${pageContent[54].description}`}
    callToAction={{
      text: `${pageContent[55].title}`,
      // TODO; create contact form
      href: `${pageContent[55].description}`,
    }}
    items={[...pageContent].slice(56,60)}
  />

  <!-- Use Cases Blog Widget **************** -->

  <BlogLatestPosts
    id="blog"
    title={`${pageContent[60].title}`}
    information={`${pageContent[60].description}`}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </BlogLatestPosts>
</Layout>
